<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Stats - LA CHATTE</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7; }
    h1 { text-align: center; }
    .controls { display: flex; justify-content: center; gap: 20px; margin-bottom: 30px; }
    canvas { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h1>Comparateur de Statistiques - LA CHATTE</h1>
  <div class="controls">
    <label>Joueur 1:
      <select id="player1"></select>
    </label>
    <label>Joueur 2:
      <select id="player2"></select>
    </label>
  </div>
  <canvas id="statsChart" width="800" height="400"></canvas>

  <script>
    const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR_0qjFwqt3Xka_KMzOQLUuUG-XD0Mu_I1XzHMHJXp0OELC-NwuTd98QPbfi-dAprOzb3r8iEUjAlCV/pub?gid=514799740&single=true&output=csv";

    const select1 = document.getElementById("player1");
    const select2 = document.getElementById("player2");
    const ctx = document.getElementById("statsChart").getContext("2d");
    let chart;

    fetch(csvUrl)
      .then(response => response.text())
      .then(csv => {
        const parsed = Papa.parse(csv, { header: true });
        const rows = parsed.data.filter(row => row["Statistique"]); // Nettoyage
        const stats = rows.map(row => row["Statistique"]);
        const players = Object.keys(rows[0]).filter(k => k !== "Statistique");

        // Construire les données { joueur: [valeurs] }
        const data = {};
        players.forEach(player => {
          data[player] = rows.map(row => parseFloat(row[player]) || 0);
        });

        // Remplir les menus déroulants
        players.forEach(player => {
          const opt1 = new Option(player, player);
          const opt2 = new Option(player, player);
          select1.add(opt1);
          select2.add(opt2);
        });

        select1.value = players[0];
        select2.value = players[1];

        function updateChart() {
          const p1 = select1.value;
          const p2 = select2.value;

          if (chart) chart.destroy();
          chart = new Chart(ctx, {
            type: "bar",
            data: {
              labels: stats,
              datasets: [
                {
                  label: p1,
                  data: data[p1],
                  backgroundColor: "#3e95cd"
                },
                {
                  label: p2,
                  data: data[p2],
                  backgroundColor: "#8e5ea2"
                }
              ]
            },
            options: {
              responsive: true,
              scales: {
                x: { ticks: { autoSkip: false } },
                y: { beginAtZero: true }
              }
            }
          });
        }

        select1.onchange = updateChart;
        select2.onchange = updateChart;
        updateChart();
      })
      .catch(err => {
        console.error("Erreur de chargement du CSV :", err);
        alert("Impossible de charger les statistiques.");
      });
  </script>
</body>
</html>
